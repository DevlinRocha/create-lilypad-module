#!/usr/bin/env bash

CONFIG_FILE=".env"
source $CONFIG_FILE

if [[ -z "$DOCKER_HUB_USERNAME" ]]; then
    printf "\nEnter your Docker Hub username: "
    read -r DOCKER_HUB_USERNAME
    DOCKER_HUB_USERNAME=$DOCKER_HUB_USERNAME
else
    printf "\nEnter your Docker Hub username:"
    printf "\n(Current: $DOCKER_HUB_USERNAME) ‚û°Ô∏è  "
    read -r NEW_DOCKER_HUB_USERNAME
    DOCKER_HUB_USERNAME=${NEW_DOCKER_HUB_USERNAME:-$DOCKER_HUB_USERNAME}
fi

if [[ -z "$DOCKER_HUB_REPO" ]]; then
    printf "\nEnter the name of the Docker Hub repository: "
    read -r DOCKER_HUB_REPO
    DOCKER_HUB_REPO=$DOCKER_HUB_REPO
else
    printf "\nEnter the name of the Docker Hub repository:"
    printf "\n(Current: $DOCKER_HUB_REPO) ‚û°Ô∏è  "
    read -r NEW_DOCKER_HUB_REPO
    DOCKER_HUB_REPO=${NEW_DOCKER_HUB_REPO:-$DOCKER_HUB_REPO}
fi

if [[ -z "$DOCKER_TAG" ]]; then
    printf "\nEnter the tag for the Docker image:"
    printf "\n(Default: \"latest\") ‚û°Ô∏è  "
    read -r DOCKER_TAG
    DOCKER_TAG=${DOCKER_TAG:-\"latest\"}
else
    printf "\nEnter the tag for the Docker image:"
    printf "\n(Current: $DOCKER_TAG) ‚û°Ô∏è  "
    read -r NEW_DOCKER_TAG
    DOCKER_TAG=${NEW_DOCKER_TAG:-$DOCKER_TAG}
fi

if [[ -z "$GITHUB_REPO" ]]; then
    printf "\nEnter the GitHub repository URL for the module: "
    read -r GITHUB_REPO
    GITHUB_REPO=$GITHUB_REPO
else
    printf "\nEnter the GitHub repository URL for the module: "
    printf "\n(Current: $GITHUB_REPO) ‚û°Ô∏è  "
    read -r NEW_GITHUB_REPO
    GITHUB_REPO=${NEW_GITHUB_REPO:-$GITHUB_REPO}
fi

if [[ -z "$GITHUB_TAG" ]]; then
    printf "\nEnter the GitHub tag, branch, or commit hash:"
    printf "\n(Default: \"main\") ‚û°Ô∏è  "
    read -r GITHUB_TAG
    GITHUB_TAG=${GITHUB_TAG:-"main"}
else
    printf "\nEnter the GitHub tag, branch, or commit hash:"
    printf "\n(Current: $GITHUB_TAG) ‚û°Ô∏è  "
    read -r NEW_GITHUB_TAG
    GITHUB_TAG=${NEW_GITHUB_TAG:-$GITHUB_TAG}
fi

if [[ -z "$WEB3_PRIVATE_KEY" ]]; then
    printf "\nEnter your Web3 private key: "
    read -r NEW_WEB3_PRIVATE_KEY
    WEB3_PRIVATE_KEY=${NEW_WEB3_PRIVATE_KEY:-$WEB3_PRIVATE_KEY}
fi

# Save Docker Hub username to config file
cat <<EOF >$CONFIG_FILE
DOCKER_HUB_USERNAME=$DOCKER_HUB_USERNAME
DOCKER_HUB_REPO=$DOCKER_HUB_REPO
DOCKER_TAG=$DOCKER_TAG
GITHUB_REPO=$GITHUB_REPO
GITHUB_TAG=$GITHUB_TAG
# üö® Do not share or commit this key! üö®
WEB3_PRIVATE_KEY=$WEB3_PRIVATE_KEY
DEMONET_PRIVATE_KEY="0ec38dd1ee0898dae8460b269859b4fb3cb519b35d82014c909ec4741c790831"
EOF

echo "‚úÖ Configuration saved!"
